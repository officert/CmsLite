var CkEditorImageBrowser={folders:[],images:{},ckFunctionNum:null,init:function(){CkEditorImageBrowser.ckFunctionNum=CkEditorImageBrowser.getQueryStringParam("CKEditorFuncNum");CkEditorImageBrowser.initEventHandlers();CkEditorImageBrowser.loadData(decodeURIComponent(CkEditorImageBrowser.getQueryStringParam("listUrl")),function(){CkEditorImageBrowser.initFolderSwitcher()})},loadData:function(a,c){CkEditorImageBrowser.folders=[];CkEditorImageBrowser.images={};$.getJSON(a,function(a){$.each(a,function(a,
b){"undefined"===typeof b.folder&&(b.folder="Images");CkEditorImageBrowser.ensureFolderCreated(b.folder);CkEditorImageBrowser.addImage(b.folder,b.image,b.thumb)});c()})},ensureFolderCreated:function(a){-1===CkEditorImageBrowser.folders.indexOf(a)&&(CkEditorImageBrowser.folders.push(a),CkEditorImageBrowser.images[a]=[])},addImage:function(a,c,e){CkEditorImageBrowser.images[a].push({imageUrl:c,thumbUrl:e})},initFolderSwitcher:function(){var a=$("#js-folder-switcher");a.find("option").remove();$.each(CkEditorImageBrowser.folders,
function(c,e){$("<option></option>").val(c).text(e).appendTo(a)});1===CkEditorImageBrowser.folders.length&&a.hide();a.trigger("change")},renderImagesForFolder:function(a){var a=CkEditorImageBrowser.images[a],c=$("#js-template-image").html(),e=$("#js-images-container");e.html("");$.each(a,function(a,b){var d=c,d=d.replace("%imageUrl%",b.imageUrl),d=d.replace("%thumbUrl%",b.thumbUrl),d=$($.parseHTML(d));e.append(d)})},initEventHandlers:function(){$("#js-folder-switcher").change(function(){var a=parseInt($(this).val(),
10);CkEditorImageBrowser.renderImagesForFolder(CkEditorImageBrowser.folders[a])});$(document).on("click",".js-image-link",function(){var a=$(this).data("url");window.opener.CKEDITOR.tools.callFunction(CkEditorImageBrowser.ckFunctionNum,a);window.close()})},getQueryStringParam:function(a){return(a=window.location.search.match(RegExp("[?|&]"+a+"=(.+?)[&|$]")))&&1<a.length?a[1]:null}};